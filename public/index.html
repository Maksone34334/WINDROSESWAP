<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monorail DEX API - Crypto Exchange</title>
    <script src="https://cdn.ethers.io/lib/ethers-6.15.0.umd.min.js" type="application/javascript"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-6.12.1.umd.min.js" type="application/javascript"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        /* Swap Interface Styles */
        .swap-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .swap-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .swap-header h2 {
            color: #4a5568;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .token-input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .token-selector {
            display: flex;
            align-items: center;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
            pointer-events: auto;
        }

        .token-selector:hover {
            border-color: #667eea;
            background: #edf2f7;
        }

        .token-selector.active {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .token-info {
            display: flex;
            align-items: center;
            flex: 1;
            pointer-events: none;
        }

        .token-logo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 12px;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #4a5568;
        }

        .token-details h3 {
            font-size: 1.1rem;
            color: #2d3748;
            margin-bottom: 2px;
        }

        .token-details p {
            font-size: 0.9rem;
            color: #718096;
        }

        .dropdown-arrow {
            margin-left: auto;
            transition: transform 0.3s ease;
            pointer-events: none;
        }

        .token-selector.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .amount-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1.1rem;
            margin-top: 10px;
            transition: border-color 0.3s ease;
        }

        .amount-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .swap-arrow {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .swap-arrow button {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .swap-arrow button:hover {
            background: #5a67d8;
            transform: rotate(180deg);
        }

        /* Button Styles */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin: 10px 0;
            position: relative;
            z-index: 1;
            pointer-events: auto;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-header h3 {
            color: #2d3748;
            font-size: 1.3rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #718096;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #f7fafc;
            color: #2d3748;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .token-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .token-item {
            display: flex;
            align-items: center;
            padding: 15px;
            cursor: pointer;
            border-radius: 10px;
            transition: background-color 0.2s ease;
            margin-bottom: 5px;
        }

        .token-item:hover {
            background: #f7fafc;
        }

        .token-item .token-logo {
            margin-right: 15px;
        }

        .token-item .token-info {
            flex: 1;
        }

        .token-item .token-balance {
            color: #718096;
            font-size: 0.9rem;
        }

        /* Wallet Connection */
        .wallet-status {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .wallet-connected {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .wallet-address {
            font-family: monospace;
            background: #e2e8f0;
            padding: 8px 12px;
            border-radius: 6px;
            margin: 10px 0;
            word-break: break-all;
        }

        /* Loading and Error States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #e53e3e;
        }

        .success-message {
            background: #c6f6d5;
            color: #2f855a;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #38a169;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 20px;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        /* API Documentation Styles */
        .api-section {
            margin-bottom: 30px;
        }

        .endpoint {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }

        .endpoint-method {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 10px;
        }

        .endpoint-url {
            font-family: monospace;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .test-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .test-btn:hover {
            background: #218838;
        }

        .response-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Monorail DEX</h1>
            <p>Decentralized Exchange API & Swap Interface</p>
        </div>

        <!-- Wallet Connection Status -->
        <div id="walletStatus" class="wallet-status">
            <h3>💼 Wallet Connection</h3>
            <p id="walletStatusText">Connect your MetaMask wallet to start trading</p>
            <div id="walletAddress" class="wallet-address" style="display: none;"></div>
            <button id="connectWalletBtn" class="btn">Connect MetaMask</button>
            <button id="addNetworkBtn" class="btn btn-secondary" style="display: none;">Add Monad Network</button>
        </div>

        <!-- Swap Interface -->
        <div class="swap-container">
            <div class="swap-header">
                <h2>💱 Token Swap</h2>
                <p>Exchange tokens on Monad Network</p>
            </div>

            <div class="token-input-group">
                <label>From</label>
                <div id="fromTokenSelector" class="token-selector" data-target="from">
                    <div class="token-info">
                        <div class="token-logo">?</div>
                        <div class="token-details">
                            <h3>Select Token</h3>
                            <p>Choose token to swap from</p>
                        </div>
                    </div>
                    <div class="dropdown-arrow">▼</div>
                </div>
                <input type="number" id="fromAmount" class="amount-input" placeholder="0.0" step="any" min="0">
            </div>

            <div class="swap-arrow">
                <button id="swapArrow" type="button">⇅</button>
            </div>

            <div class="token-input-group">
                <label>To</label>
                <div id="toTokenSelector" class="token-selector" data-target="to">
                    <div class="token-info">
                        <div class="token-logo">?</div>
                        <div class="token-details">
                            <h3>Select Token</h3>
                            <p>Choose token to receive</p>
                        </div>
                    </div>
                    <div class="dropdown-arrow">▼</div>
                </div>
                <input type="number" id="toAmount" class="amount-input" placeholder="0.0" readonly>
            </div>

            <div id="swapInfo" style="display: none; margin: 20px 0; padding: 15px; background: #f7fafc; border-radius: 10px;">
                <div id="priceImpact"></div>
                <div id="minimumReceived"></div>
                <div id="tradingFee"></div>
            </div>

            <button id="getQuoteBtn" class="btn">Get Quote</button>
            <button id="executeSwapBtn" class="btn" style="display: none;">Execute Swap</button>
            <button id="checkBalanceBtn" class="btn btn-secondary">Check My Balance</button>
        </div>

        <!-- API Documentation -->
        <div class="main-content">
            <div class="card">
                <h2>📊 Token Data API</h2>
                <div class="api-section">
                    <div class="endpoint">
                        <span class="endpoint-method">GET</span>
                        <code class="endpoint-url">/api/tokens/count</code>
                        <p>Get total number of available tokens</p>
                        <button class="test-btn" onclick="testEndpoint('/api/tokens/count', 'GET')">Test</button>
                        <div id="response-tokens-count" class="response-area" style="display: none;"></div>
                    </div>

                    <div class="endpoint">
                        <span class="endpoint-method">GET</span>
                        <code class="endpoint-url">/api/tokens/category/verified</code>
                        <p>Get verified tokens (recommended for trading)</p>
                        <button class="test-btn" onclick="testEndpoint('/api/tokens/category/verified?limit=5', 'GET')">Test</button>
                        <div id="response-verified-tokens" class="response-area" style="display: none;"></div>
                    </div>

                    <div class="endpoint">
                        <span class="endpoint-method">GET</span>
                        <code class="endpoint-url">/api/tokens</code>
                        <p>Search all available tokens</p>
                        <button class="test-btn" onclick="testEndpoint('/api/tokens?limit=3', 'GET')">Test</button>
                        <div id="response-all-tokens" class="response-area" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>💹 Trading API</h2>
                <div class="api-section">
                    <div class="endpoint">
                        <span class="endpoint-method">POST</span>
                        <code class="endpoint-url">/api/quote</code>
                        <p>Get swap quote with price and transaction data</p>
                        <button class="test-btn" onclick="testQuoteEndpoint()">Test</button>
                        <div id="response-quote" class="response-area" style="display: none;"></div>
                    </div>

                    <div class="endpoint">
                        <span class="endpoint-method">GET</span>
                        <code class="endpoint-url">/api/wallet/{address}/balances</code>
                        <p>Get token balances for a wallet address</p>
                        <button class="test-btn" onclick="testWalletBalance()">Test</button>
                        <div id="response-wallet" class="response-area" style="display: none;"></div>
                    </div>

                    <div class="endpoint">
                        <span class="endpoint-method">POST</span>
                        <code class="endpoint-url">/api/swap</code>
                        <p>Execute token swap (requires connected wallet)</p>
                        <button class="test-btn" onclick="testSwapExecution()">Test</button>
                        <div id="response-swap" class="response-area" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features Grid -->
        <div class="main-content">
            <div class="card">
                <h2>🔥 Key Features</h2>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin: 10px 0; padding: 10px; background: #f7fafc; border-radius: 8px;">
                        <strong>🔗 Real DEX Integration:</strong> Direct connection to Monorail DEX on Monad Network
                    </li>
                    <li style="margin: 10px 0; padding: 10px; background: #f7fafc; border-radius: 8px;">
                        <strong>💼 MetaMask Support:</strong> Seamless wallet connection and transaction signing
                    </li>
                    <li style="margin: 10px 0; padding: 10px; background: #f7fafc; border-radius: 8px;">
                        <strong>📊 7000+ Tokens:</strong> Access to extensive token database with real-time data
                    </li>
                    <li style="margin: 10px 0; padding: 10px; background: #f7fafc; border-radius: 8px;">
                        <strong>⚡ 11 DEX Aggregation:</strong> Best prices across multiple exchanges
                    </li>
                    <li style="margin: 10px 0; padding: 10px; background: #f7fafc; border-radius: 8px;">
                        <strong>🛡️ Type Safety:</strong> Full TypeScript implementation with Zod validation
                    </li>
                </ul>
            </div>

            <div class="card">
                <h2>🚀 Quick Start</h2>
                <ol style="line-height: 1.8;">
                    <li><strong>Connect Wallet:</strong> Click "Connect MetaMask" button</li>
                    <li><strong>Add Network:</strong> Add Monad Testnet to your wallet</li>
                    <li><strong>Select Tokens:</strong> Choose tokens to swap from dropdown</li>
                    <li><strong>Enter Amount:</strong> Specify how much you want to swap</li>
                    <li><strong>Get Quote:</strong> See price and transaction details</li>
                    <li><strong>Execute Swap:</strong> Confirm transaction in MetaMask</li>
                </ol>
                
                <div style="margin-top: 20px; padding: 15px; background: #e6fffa; border-radius: 10px; border-left: 4px solid #38b2ac;">
                    <strong>💡 Pro Tip:</strong> Always check the price impact before executing large swaps!
                </div>
            </div>
        </div>
    </div>

    <!-- Token Selection Modal -->
    <div id="tokenModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Token</h3>
                <button class="close-btn" onclick="closeTokenModal()">&times;</button>
            </div>
            <input type="text" id="tokenSearch" class="search-input" placeholder="Search tokens...">
            <div id="tokenList" class="token-list">
                <div style="text-align: center; padding: 20px; color: #718096;">
                    <div class="loading"></div>
                    <p style="margin-top: 10px;">Loading tokens...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // GLOBAL STATE MANAGEMENT
        // ============================================================================
        
        /**
         * Application State
         * Centralized state management for better debugging and maintenance
         */
        const AppState = {
            // Wallet connection state
            wallet: {
                isConnected: false,
                address: null,
                provider: null,
                signer: null
            },
            
            // Token selection state
            tokens: {
                available: [],
                selected: {
                    from: null,
                    to: null
                },
                balances: {}
            },
            
            // Swap state
            swap: {
                quote: null,
                isLoading: false,
                lastError: null
            },
            
            // UI state
            ui: {
                activeModal: null,
                currentTokenTarget: null
            }
        };

        // ============================================================================
        // CONFIGURATION
        // ============================================================================
        
        const CONFIG = {
            // Monad Network Configuration
            MONAD_NETWORK: {
                chainId: '0x2C89E', // 183966 in hex
                chainName: 'Monad Testnet',
                nativeCurrency: {
                    name: 'MON',
                    symbol: 'MON',
                    decimals: 18
                },
                rpcUrls: ['https://testnet-rpc.monad.xyz'],
                blockExplorerUrls: ['https://testnet-explorer.monad.xyz']
            },
            
            // API Configuration
            API: {
                BASE_URL: window.location.origin,
                ENDPOINTS: {
                    TOKENS: '/api/tokens',
                    TOKENS_BY_CATEGORY: '/api/tokens/category',
                    TOKEN_COUNT: '/api/tokens/count',
                    WALLET_BALANCES: '/api/wallet',
                    QUOTE: '/api/quote',
                    SWAP: '/api/swap'
                }
            },
            
            // Default tokens for quick access
            DEFAULT_TOKENS: [
                { symbol: 'BEAN', name: 'Bean Token' },
                { symbol: 'CHOG', name: 'Chog Token' },
                { symbol: 'MON', name: 'Monad' }
            ]
        };

        // ============================================================================
        // UTILITY FUNCTIONS
        // ============================================================================
        
        /**
         * Utility class for common operations
         */
        class Utils {
            /**
             * Format address for display (0x1234...5678)
             */
            static formatAddress(address) {
                if (!address) return '';
                return `${address.slice(0, 6)}...${address.slice(-4)}`;
            }
            
            /**
             * Format number with appropriate decimals
             */
            static formatNumber(num, decimals = 4) {
                if (!num) return '0';
                const number = typeof num === 'string' ? parseFloat(num) : num;
                return number.toLocaleString('en-US', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: decimals
                });
            }
            
            /**
             * Validate Ethereum address
             */
            static isValidAddress(address) {
                return /^0x[a-fA-F0-9]{40}$/.test(address);
            }
            
            /**
             * Show user notification
             */
            static showNotification(message, type = 'info') {
                // Remove existing notifications
                const existing = document.querySelector('.notification');
                if (existing) existing.remove();
                
                const notification = document.createElement('div');
                notification.className = `notification ${type === 'error' ? 'error-message' : 'success-message'}`;
                notification.textContent = message;
                notification.style.position = 'fixed';
                notification.style.top = '20px';
                notification.style.right = '20px';
                notification.style.zIndex = '10000';
                notification.style.maxWidth = '300px';
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 5000);
            }
            
            /**
             * Debounce function calls
             */
            static debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }
        }

        // ============================================================================
        // API CLIENT
        // ============================================================================
        
        /**
         * API Client for backend communication
         * Handles all HTTP requests with proper error handling
         */
        class ApiClient {
            constructor(baseUrl) {
                this.baseUrl = baseUrl;
            }
            
            /**
             * Generic API request method
             */
            async request(endpoint, options = {}) {
                try {
                    const url = `${this.baseUrl}${endpoint}`;
                    const config = {
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        },
                        ...options
                    };
                    
                    console.log(`API Request: ${options.method || 'GET'} ${url}`);
                    
                    const response = await fetch(url, config);
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.message || `HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    return data;
                } catch (error) {
                    console.error('API Request failed:', error);
                    throw error;
                }
            }
            
            /**
             * Get all tokens with optional filtering
             */
            async getTokens(params = {}) {
                const queryString = new URLSearchParams(params).toString();
                const endpoint = queryString ? `${CONFIG.API.ENDPOINTS.TOKENS}?${queryString}` : CONFIG.API.ENDPOINTS.TOKENS;
                return this.request(endpoint);
            }
            
            /**
             * Get tokens by category
             */
            async getTokensByCategory(category, params = {}) {
                const queryString = new URLSearchParams(params).toString();
                const endpoint = queryString 
                    ? `${CONFIG.API.ENDPOINTS.TOKENS_BY_CATEGORY}/${category}?${queryString}`
                    : `${CONFIG.API.ENDPOINTS.TOKENS_BY_CATEGORY}/${category}`;
                return this.request(endpoint);
            }
            
            /**
             * Get token count
             */
            async getTokenCount() {
                return this.request(CONFIG.API.ENDPOINTS.TOKEN_COUNT);
            }
            
            /**
             * Get wallet balances
             */
            async getWalletBalances(address) {
                return this.request(`${CONFIG.API.ENDPOINTS.WALLET_BALANCES}/${address}/balances`);
            }
            
            /**
             * Get swap quote
             */
            async getQuote(params) {
                return this.request(CONFIG.API.ENDPOINTS.QUOTE, {
                    method: 'POST',
                    body: JSON.stringify(params)
                });
            }
            
            /**
             * Execute swap
             */
            async executeSwap(params) {
                return this.request(CONFIG.API.ENDPOINTS.SWAP, {
                    method: 'POST',
                    body: JSON.stringify(params)
                });
            }
        }

        // ============================================================================
        // WALLET MANAGER
        // ============================================================================
        
        /**
         * Wallet Manager for MetaMask integration
         * Handles all wallet-related operations
         */
        class WalletManager {
            constructor() {
                this.provider = null;
                this.signer = null;
            }
            
            /**
             * Check if MetaMask is installed
             */
            isMetaMaskInstalled() {
                return typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask;
            }
            
            /**
             * Check if wallet is already connected
             */
            async checkConnection() {
                try {
                    if (!this.isMetaMaskInstalled()) {
                        return false;
                    }
                    
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_accounts' 
                    });
                    
                    if (accounts.length > 0) {
                        AppState.wallet.isConnected = true;
                        AppState.wallet.address = accounts[0];
                        this.setupProvider();
                        return true;
                    }
                    
                    return false;
                } catch (error) {
                    console.error('Error checking wallet connection:', error);
                    return false;
                }
            }
            
            /**
             * Connect to MetaMask wallet
             */
            async connect() {
                try {
                    if (!this.isMetaMaskInstalled()) {
                        throw new Error('MetaMask is not installed. Please install MetaMask to continue.');
                    }
                    
                    // Request account access
                    const accounts = await window.ethereum.request({
                        method: 'eth_requestAccounts'
                    });
                    
                    if (accounts.length === 0) {
                        throw new Error('No accounts found. Please unlock MetaMask.');
                    }
                    
                    AppState.wallet.isConnected = true;
                    AppState.wallet.address = accounts[0];
                    
                    this.setupProvider();
                    this.setupEventListeners();
                    
                    // Try to switch to Monad network
                    await this.switchToMonadNetwork();
                    
                    Utils.showNotification('Wallet connected successfully!', 'success');
                    return accounts[0];
                    
                } catch (error) {
                    console.error('Wallet connection failed:', error);
                    Utils.showNotification(`Connection failed: ${error.message}`, 'error');
                    throw error;
                }
            }
            
            /**
             * Setup ethers provider and signer
             */
            setupProvider() {
                if (window.ethereum) {
                    this.provider = new ethers.BrowserProvider(window.ethereum);
                    this.provider.getSigner().then(signer => {
                        this.signer = signer;
                        AppState.wallet.provider = this.provider;
                        AppState.wallet.signer = signer;
                    });
                }
            }
            
            /**
             * Setup event listeners for wallet events
             */
            setupEventListeners() {
                if (window.ethereum) {
                    // Account changed
                    window.ethereum.on('accountsChanged', (accounts) => {
                        if (accounts.length === 0) {
                            this.disconnect();
                        } else {
                            AppState.wallet.address = accounts[0];
                            this.updateUI();
                        }
                    });
                    
                    // Chain changed
                    window.ethereum.on('chainChanged', (chainId) => {
                        console.log('Chain changed to:', chainId);
                        this.updateUI();
                    });
                }
            }
            
            /**
             * Disconnect wallet
             */
            disconnect() {
                AppState.wallet.isConnected = false;
                AppState.wallet.address = null;
                AppState.wallet.provider = null;
                AppState.wallet.signer = null;
                this.provider = null;
                this.signer = null;
                this.updateUI();
            }
            
            /**
             * Switch to Monad network
             */
            async switchToMonadNetwork() {
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: CONFIG.MONAD_NETWORK.chainId }],
                    });
                } catch (switchError) {
                    // This error code indicates that the chain has not been added to MetaMask
                    if (switchError.code === 4902) {
                        await this.addMonadNetwork();
                    } else {
                        throw switchError;
                    }
                }
            }
            
            /**
             * Add Monad network to MetaMask
             */
            async addMonadNetwork() {
                try {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [CONFIG.MONAD_NETWORK],
                    });
                    Utils.showNotification('Monad network added successfully!', 'success');
                } catch (error) {
                    console.error('Failed to add Monad network:', error);
                    Utils.showNotification(`Failed to add network: ${error.message}`, 'error');
                    throw error;
                }
            }
            
            /**
             * Execute transaction
             */
            async executeTransaction(txData) {
                try {
                    if (!this.signer) {
                        throw new Error('Wallet not connected');
                    }
                    
                    const tx = await this.signer.sendTransaction({
                        to: txData.to,
                        data: txData.data,
                        value: txData.value || '0x0',
                        gasLimit: txData.gasLimit,
                        gasPrice: txData.gasPrice
                    });
                    
                    Utils.showNotification('Transaction submitted! Waiting for confirmation...', 'success');
                    
                    const receipt = await tx.wait();
                    Utils.showNotification('Transaction confirmed!', 'success');
                    
                    return receipt;
                } catch (error) {
                    console.error('Transaction failed:', error);
                    Utils.showNotification(`Transaction failed: ${error.message}`, 'error');
                    throw error;
                }
            }
            
            /**
             * Update UI based on wallet state
             */
            updateUI() {
                const walletStatus = document.getElementById('walletStatus');
                const walletStatusText = document.getElementById('walletStatusText');
                const walletAddress = document.getElementById('walletAddress');
                const connectBtn = document.getElementById('connectWalletBtn');
                const addNetworkBtn = document.getElementById('addNetworkBtn');
                
                if (AppState.wallet.isConnected) {
                    walletStatus.classList.add('wallet-connected');
                    walletStatusText.textContent = '✅ Wallet Connected';
                    walletAddress.textContent = Utils.formatAddress(AppState.wallet.address);
                    walletAddress.style.display = 'block';
                    connectBtn.textContent = 'Disconnect';
                    addNetworkBtn.style.display = 'inline-block';
                } else {
                    walletStatus.classList.remove('wallet-connected');
                    walletStatusText.textContent = 'Connect your MetaMask wallet to start trading';
                    walletAddress.style.display = 'none';
                    connectBtn.textContent = 'Connect MetaMask';
                    addNetworkBtn.style.display = 'none';
                }
            }
        }

        // ============================================================================
        // TOKEN MANAGER
        // ============================================================================
        
        /**
         * Token Manager for token-related operations
         */
        class TokenManager {
            constructor(apiClient) {
                this.apiClient = apiClient;
            }
            
            /**
             * Load available tokens
             */
            async loadTokens() {
                try {
                    // Load verified tokens first (recommended for trading)
                    const verifiedResponse = await this.apiClient.getTokensByCategory('verified', { limit: 100 });
                    AppState.tokens.available = verifiedResponse.data || [];
                    
                    console.log(`Loaded ${AppState.tokens.available.length} verified tokens`);
                    return AppState.tokens.available;
                } catch (error) {
                    console.error('Failed to load tokens:', error);
                    Utils.showNotification('Failed to load tokens', 'error');
                    return [];
                }
            }
            
            /**
             * Search tokens by query
             */
            searchTokens(query) {
                if (!query) return AppState.tokens.available;
                
                const lowerQuery = query.toLowerCase();
                return AppState.tokens.available.filter(token => 
                    token.symbol.toLowerCase().includes(lowerQuery) ||
                    token.name.toLowerCase().includes(lowerQuery) ||
                    token.address.toLowerCase().includes(lowerQuery)
                );
            }
            
            /**
             * Get token by address or symbol
             */
            findToken(identifier) {
                return AppState.tokens.available.find(token => 
                    token.address.toLowerCase() === identifier.toLowerCase() ||
                    token.symbol.toLowerCase() === identifier.toLowerCase()
                );
            }
            
            /**
             * Load wallet balances
             */
            async loadWalletBalances(address) {
                try {
                    const response = await this.apiClient.getWalletBalances(address);
                    const balances = response.data || [];
                    
                    // Store balances in state
                    AppState.tokens.balances = {};
                    balances.forEach(token => {
                        AppState.tokens.balances[token.address.toLowerCase()] = token.balance;
                    });
                    
                    return balances;
                } catch (error) {
                    console.error('Failed to load wallet balances:', error);
                    Utils.showNotification('Failed to load balances', 'error');
                    return [];
                }
            }
            
            /**
             * Get token balance
             */
            getTokenBalance(tokenAddress) {
                return AppState.tokens.balances[tokenAddress.toLowerCase()] || '0';
            }
        }

        // ============================================================================
        // SWAP MANAGER
        // ============================================================================
        
        /**
         * Swap Manager for trading operations
         */
        class SwapManager {
            constructor(apiClient, walletManager) {
                this.apiClient = apiClient;
                this.walletManager = walletManager;
            }
            
            /**
             * Get swap quote
             */
            async getQuote(fromToken, toToken, amount, slippage = 50) {
                try {
                    if (!fromToken || !toToken || !amount) {
                        throw new Error('Missing required parameters for quote');
                    }
                    
                    AppState.swap.isLoading = true;
                    AppState.swap.lastError = null;
                    
                    const quoteParams = {
                        amount: amount.toString(),
                        from: fromToken.address,
                        to: toToken.address,
                        sender: AppState.wallet.address,
                        slippage: slippage
                    };
                    
                    console.log('Getting quote with params:', quoteParams);
                    
                    const response = await this.apiClient.getQuote(quoteParams);
                    AppState.swap.quote = response.data;
                    
                    return response.data;
                } catch (error) {
                    console.error('Failed to get quote:', error);
                    AppState.swap.lastError = error.message;
                    Utils.showNotification(`Quote failed: ${error.message}`, 'error');
                    throw error;
                } finally {
                    AppState.swap.isLoading = false;
                }
            }
            
            /**
             * Execute swap transaction
             */
            async executeSwap(fromToken, toToken, amount, slippage = 50) {
                try {
                    if (!AppState.wallet.isConnected) {
                        throw new Error('Wallet not connected');
                    }
                    
                    if (!fromToken || !toToken || !amount) {
                        throw new Error('Missing required parameters for swap');
                    }
                    
                    AppState.swap.isLoading = true;
                    
                    const swapParams = {
                        amount: amount.toString(),
                        from: fromToken.address,
                        to: toToken.address,
                        sender: AppState.wallet.address,
                        slippage: slippage
                    };
                    
                    console.log('Executing swap with params:', swapParams);
                    
                    // Get transaction data from API
                    const response = await this.apiClient.executeSwap(swapParams);
                    const txData = response.data.transaction;
                    
                    // Execute transaction through wallet
                    const receipt = await this.walletManager.executeTransaction(txData);
                    
                    Utils.showNotification('Swap completed successfully!', 'success');
                    return receipt;
                    
                } catch (error) {
                    console.error('Swap execution failed:', error);
                    Utils.showNotification(`Swap failed: ${error.message}`, 'error');
                    throw error;
                } finally {
                    AppState.swap.isLoading = false;
                }
            }
        }

        // ============================================================================
        // UI MANAGER
        // ============================================================================
        
        /**
         * UI Manager for interface interactions
         */
        class UIManager {
            constructor(tokenManager) {
                this.tokenManager = tokenManager;
                this.setupEventListeners();
            }
            
            /**
             * Setup all event listeners
             */
            setupEventListeners() {
                // Token selector clicks
                document.getElementById('fromTokenSelector').addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.openTokenModal('from');
                });
                
                document.getElementById('toTokenSelector').addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    this.openTokenModal('to');
                });
                
                // Swap arrow
                document.getElementById('swapArrow').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.swapTokens();
                });
                
                // Amount input
                document.getElementById('fromAmount').addEventListener('input', 
                    Utils.debounce((e) => this.onAmountChange(e.target.value), 500)
                );
                
                // Modal close
                document.getElementById('tokenModal').addEventListener('click', (e) => {
                    if (e.target.id === 'tokenModal') {
                        this.closeTokenModal();
                    }
                });
                
                // Token search
                document.getElementById('tokenSearch').addEventListener('input', 
                    Utils.debounce((e) => this.filterTokens(e.target.value), 300)
                );
            }
            
            /**
             * Open token selection modal
             */
            async openTokenModal(target) {
                try {
                    AppState.ui.currentTokenTarget = target;
                    AppState.ui.activeModal = 'token';
                    
                    const modal = document.getElementById('tokenModal');
                    modal.classList.add('show');
                    
                    // Load tokens if not already loaded
                    if (AppState.tokens.available.length === 0) {
                        await this.tokenManager.loadTokens();
                    }
                    
                    this.renderTokenList(AppState.tokens.available);
                    
                    // Clear search
                    document.getElementById('tokenSearch').value = '';
                    document.getElementById('tokenSearch').focus();
                    
                } catch (error) {
                    console.error('Failed to open token modal:', error);
                    Utils.showNotification('Failed to load tokens', 'error');
                }
            }
            
            /**
             * Close token selection modal
             */
            closeTokenModal() {
                const modal = document.getElementById('tokenModal');
                modal.classList.remove('show');
                AppState.ui.activeModal = null;
                AppState.ui.currentTokenTarget = null;
            }
            
            /**
             * Render token list in modal
             */
            renderTokenList(tokens) {
                const tokenList = document.getElementById('tokenList');
                
                if (tokens.length === 0) {
                    tokenList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #718096;">
                            <p>No tokens found</p>
                        </div>
                    `;
                    return;
                }
                
                tokenList.innerHTML = tokens.map(token => {
                    const balance = this.tokenManager.getTokenBalance(token.address);
                    const formattedBalance = balance !== '0' ? Utils.formatNumber(balance) : '0';
                    
                    return `
                        <div class="token-item" onclick="selectToken('${token.address}')">
                            <div class="token-logo">${token.symbol.charAt(0)}</div>
                            <div class="token-info">
                                <div class="token-details">
                                    <h3>${token.symbol}</h3>
                                    <p>${token.name}</p>
                                </div>
                            </div>
                            <div class="token-balance">${formattedBalance}</div>
                        </div>
                    `;
                }).join('');
            }
            
            /**
             * Filter tokens based on search query
             */
            filterTokens(query) {
                const filteredTokens = this.tokenManager.searchTokens(query);
                this.renderTokenList(filteredTokens);
            }
            
            /**
             * Select token from modal
             */
            selectToken(tokenAddress) {
                const token = this.tokenManager.findToken(tokenAddress);
                if (!token) return;
                
                const target = AppState.ui.currentTokenTarget;
                if (!target) return;
                
                // Update state
                AppState.tokens.selected[target] = token;
                
                // Update UI
                this.updateTokenSelector(target, token);
                this.closeTokenModal();
                
                // Auto-quote if both tokens selected and amount entered
                if (AppState.tokens.selected.from && AppState.tokens.selected.to) {
                    const amount = document.getElementById('fromAmount').value;
                    if (amount && parseFloat(amount) > 0) {
                        this.getQuote();
                    }
                }
            }
            
            /**
             * Update token selector display
             */
            updateTokenSelector(target, token) {
                const selector = document.getElementById(`${target}TokenSelector`);
                const tokenInfo = selector.querySelector('.token-info');
                
                tokenInfo.innerHTML = `
                    <div class="token-logo">${token.symbol.charAt(0)}</div>
                    <div class="token-details">
                        <h3>${token.symbol}</h3>
                        <p>${token.name}</p>
                    </div>
                `;
            }
            
            /**
             * Swap from and to tokens
             */
            swapTokens() {
                const fromToken = AppState.tokens.selected.from;
                const toToken = AppState.tokens.selected.to;
                
                if (!fromToken || !toToken) return;
                
                // Swap tokens in state
                AppState.tokens.selected.from = toToken;
                AppState.tokens.selected.to = fromToken;
                
                // Update UI
                this.updateTokenSelector('from', toToken);
                this.updateTokenSelector('to', fromToken);
                
                // Clear amounts
                document.getElementById('fromAmount').value = '';
                document.getElementById('toAmount').value = '';
                
                // Hide swap info
                document.getElementById('swapInfo').style.display = 'none';
                document.getElementById('executeSwapBtn').style.display = 'none';
            }
            
            /**
             * Handle amount input change
             */
            async onAmountChange(amount) {
                if (!amount || parseFloat(amount) <= 0) {
                    document.getElementById('toAmount').value = '';
                    document.getElementById('swapInfo').style.display = 'none';
                    document.getElementById('executeSwapBtn').style.display = 'none';
                    return;
                }
                
                if (AppState.tokens.selected.from && AppState.tokens.selected.to) {
                    await this.getQuote();
                }
            }
            
            /**
             * Get and display quote
             */
            async getQuote() {
                try {
                    const fromToken = AppState.tokens.selected.from;
                    const toToken = AppState.tokens.selected.to;
                    const amount = document.getElementById('fromAmount').value;
                    
                    if (!fromToken || !toToken || !amount || parseFloat(amount) <= 0) {
                        return;
                    }
                    
                    // Show loading
                    document.getElementById('toAmount').value = 'Loading...';
                    
                    const quote = await app.swapManager.getQuote(fromToken, toToken, amount);
                    
                    // Update UI with quote
                    if (quote && quote.amountOut) {
                        document.getElementById('toAmount').value = Utils.formatNumber(quote.amountOut);
                        this.displaySwapInfo(quote);
                        document.getElementById('executeSwapBtn').style.display = 'block';
                    }
                    
                } catch (error) {
                    document.getElementById('toAmount').value = '';
                    document.getElementById('swapInfo').style.display = 'none';
                    document.getElementById('executeSwapBtn').style.display = 'none';
                }
            }
            
            /**
             * Display swap information
             */
            displaySwapInfo(quote) {
                const swapInfo = document.getElementById('swapInfo');
                const priceImpact = quote.priceImpact || 0;
                const minimumReceived = quote.amountOutMin || quote.amountOut;
                
                swapInfo.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Price Impact:</span>
                        <span style="color: ${priceImpact > 20 ? '#e53e3e' : priceImpact > 5 ? '#d69e2e' : '#38a169'}">
                            ${Utils.formatNumber(priceImpact, 2)}%
                        </span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Minimum Received:</span>
                        <span>${Utils.formatNumber(minimumReceived)} ${AppState.tokens.selected.to.symbol}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Trading Fee:</span>
                        <span>~0.3%</span>
                    </div>
                `;
                
                swapInfo.style.display = 'block';
                
                // Show warning for high price impact
                if (priceImpact > 20) {
                    Utils.showNotification('⚠️ High price impact detected! Consider reducing the amount.', 'error');
                }
            }
        }

        // ============================================================================
        // MAIN APPLICATION
        // ============================================================================
        
        /**
         * Main Application Class
         * Orchestrates all managers and handles initialization
         */
        class CryptoExchangeApp {
            constructor() {
                this.apiClient = new ApiClient(CONFIG.API.BASE_URL);
                this.walletManager = new WalletManager();
                this.tokenManager = new TokenManager(this.apiClient);
                this.swapManager = new SwapManager(this.apiClient, this.walletManager);
                this.uiManager = new UIManager(this.tokenManager);
            }
            
            /**
             * Initialize the application
             */
            async init() {
                try {
                    console.log('🚀 Initializing Crypto Exchange App...');
                    
                    // Check wallet connection
                    const isConnected = await this.walletManager.checkConnection();
                    if (isConnected) {
                        console.log('✅ Wallet already connected');
                        await this.tokenManager.loadWalletBalances(AppState.wallet.address);
                    }
                    
                    // Update UI
                    this.walletManager.updateUI();
                    
                    // Setup global event handlers
                    this.setupGlobalEventHandlers();
                    
                    console.log('✅ App initialized successfully');
                    
                } catch (error) {
                    console.error('❌ App initialization failed:', error);
                    Utils.showNotification(`Initialization error: ${error.message}`, 'error');
                }
            }
            
            /**
             * Setup global event handlers
             */
            setupGlobalEventHandlers() {
                // Connect wallet button
                document.getElementById('connectWalletBtn').addEventListener('click', async (e) => {
                    e.preventDefault();
                    await this.handleWalletConnection();
                });
                
                // Add network button
                document.getElementById('addNetworkBtn').addEventListener('click', async (e) => {
                    e.preventDefault();
                    await this.walletManager.addMonadNetwork();
                });
                
                // Get quote button
                document.getElementById('getQuoteBtn').addEventListener('click', async (e) => {
                    e.preventDefault();
                    await this.uiManager.getQuote();
                });
                
                // Execute swap button
                document.getElementById('executeSwapBtn').addEventListener('click', async (e) => {
                    e.preventDefault();
                    await this.handleSwapExecution();
                });
                
                // Check balance button
                document.getElementById('checkBalanceBtn').addEventListener('click', async (e) => {
                    e.preventDefault();
                    await this.handleBalanceCheck();
                });
            }
            
            /**
             * Handle wallet connection
             */
            async handleWalletConnection() {
                try {
                    if (AppState.wallet.isConnected) {
                        this.walletManager.disconnect();
                    } else {
                        await this.walletManager.connect();
                        if (AppState.wallet.address) {
                            await this.tokenManager.loadWalletBalances(AppState.wallet.address);
                        }
                    }
                    this.walletManager.updateUI();
                } catch (error) {
                    console.error('Wallet connection error:', error);
                }
            }
            
            /**
             * Handle swap execution
             */
            async handleSwapExecution() {
                try {
                    if (!AppState.wallet.isConnected) {
                        Utils.showNotification('Please connect your wallet first', 'error');
                        return;
                    }
                    
                    const fromToken = AppState.tokens.selected.from;
                    const toToken = AppState.tokens.selected.to;
                    const amount = document.getElementById('fromAmount').value;
                    
                    if (!fromToken || !toToken || !amount) {
                        Utils.showNotification('Please select tokens and enter amount', 'error');
                        return;
                    }
                    
                    // Confirm with user
                    const confirmed = confirm(`Execute swap of ${amount} ${fromToken.symbol} for ${toToken.symbol}?`);
                    if (!confirmed) return;
                    
                    await this.swapManager.executeSwap(fromToken, toToken, amount);
                    
                    // Refresh balances after successful swap
                    await this.tokenManager.loadWalletBalances(AppState.wallet.address);
                    
                } catch (error) {
                    console.error('Swap execution error:', error);
                }
            }
            
            /**
             * Handle balance check
             */
            async handleBalanceCheck() {
                try {
                    if (!AppState.wallet.isConnected) {
                        Utils.showNotification('Please connect your wallet first', 'error');
                        return;
                    }
                    
                    const balances = await this.tokenManager.loadWalletBalances(AppState.wallet.address);
                    
                    if (balances.length === 0) {
                        Utils.showNotification('No token balances found', 'info');
                    } else {
                        Utils.showNotification(`Found ${balances.length} tokens in your wallet`, 'success');
                    }
                    
                } catch (error) {
                    console.error('Balance check error:', error);
                }
            }
        }

        // ============================================================================
        // GLOBAL FUNCTIONS (for backward compatibility)
        // ============================================================================
        
        let app; // Global app instance
        
        /**
         * Global function to select token (called from HTML)
         */
        window.selectToken = function(tokenAddress) {
            if (app && app.uiManager) {
                app.uiManager.selectToken(tokenAddress);
            }
        };
        
        /**
         * Global function to close token modal
         */
        window.closeTokenModal = function() {
            if (app && app.uiManager) {
                app.uiManager.closeTokenModal();
            }
        };
        
        /**
         * Global function to toggle token selector (legacy support)
         */
        window.toggleTokenSelector = function(target) {
            if (app && app.uiManager) {
                app.uiManager.openTokenModal(target);
            }
        };
        
        /**
         * Global function to connect wallet (legacy support)
         */
        window.connectWallet = async function() {
            if (app) {
                await app.handleWalletConnection();
            }
        };

        // ============================================================================
        // API TESTING FUNCTIONS
        // ============================================================================
        
        /**
         * Test API endpoint
         */
        window.testEndpoint = async function(endpoint, method = 'GET') {
            try {
                const responseId = `response-${endpoint.replace(/[^a-zA-Z0-9]/g, '-')}`;
                const responseArea = document.getElementById(responseId);
                
                if (responseArea) {
                    responseArea.style.display = 'block';
                    responseArea.textContent = 'Loading...';
                }
                
                const response = await fetch(endpoint, { method });
                const data = await response.json();
                
                if (responseArea) {
                    responseArea.textContent = JSON.stringify(data, null, 2);
                }
                
            } catch (error) {
                const responseId = `response-${endpoint.replace(/[^a-zA-Z0-9]/g, '-')}`;
                const responseArea = document.getElementById(responseId);
                if (responseArea) {
                    responseArea.textContent = `Error: ${error.message}`;
                }
            }
        };
        
        /**
         * Test quote endpoint
         */
        window.testQuoteEndpoint = async function() {
            try {
                const responseArea = document.getElementById('response-quote');
                responseArea.style.display = 'block';
                responseArea.textContent = 'Loading...';
                
                const quoteData = {
                    amount: "1",
                    from: "BEAN",
                    to: "CHOG",
                    sender: "0x1234567890123456789012345678901234567890"
                };
                
                const response = await fetch('/api/quote', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(quoteData)
                });
                
                const data = await response.json();
                responseArea.textContent = JSON.stringify(data, null, 2);
                
            } catch (error) {
                const responseArea = document.getElementById('response-quote');
                responseArea.textContent = `Error: ${error.message}`;
            }
        };
        
        /**
         * Test wallet balance endpoint
         */
        window.testWalletBalance = async function() {
            try {
                const responseArea = document.getElementById('response-wallet');
                responseArea.style.display = 'block';
                
                if (AppState.wallet.isConnected && AppState.wallet.address) {
                    responseArea.textContent = 'Loading your balances...';
                    const response = await fetch(`/api/wallet/${AppState.wallet.address}/balances`);
                    const data = await response.json();
                    responseArea.textContent = JSON.stringify(data, null, 2);
                } else {
                    responseArea.textContent = 'Please connect your wallet first to test this endpoint';
                }
                
            } catch (error) {
                const responseArea = document.getElementById('response-wallet');
                responseArea.textContent = `Error: ${error.message}`;
            }
        };
        
        /**
         * Test swap execution endpoint
         */
        window.testSwapExecution = async function() {
            try {
                const responseArea = document.getElementById('response-swap');
                responseArea.style.display = 'block';
                
                if (!AppState.wallet.isConnected) {
                    responseArea.textContent = 'Please connect your wallet first to test swap execution';
                    return;
                }
                
                responseArea.textContent = 'This would execute a real swap. Use the swap interface above for actual trading.';
                
            } catch (error) {
                const responseArea = document.getElementById('response-swap');
                responseArea.textContent = `Error: ${error.message}`;
            }
        };

        // ============================================================================
        // APPLICATION STARTUP
        // ============================================================================
        
        /**
         * Initialize application when DOM is loaded
         */
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Create global app instance
                app = new CryptoExchangeApp();
                
                // Initialize the application
                await app.init();
                
                console.log('🎉 Crypto Exchange App is ready!');
                
            } catch (error) {
                console.error('💥 Failed to start application:', error);
                Utils.showNotification(`Failed to start app: ${error.message}`, 'error');
            }
        });

        // ============================================================================
        // ERROR HANDLING
        // ============================================================================
        
        /**
         * Global error handler
         */
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            Utils.showNotification('An unexpected error occurred', 'error');
        });
        
        /**
         * Unhandled promise rejection handler
         */
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            Utils.showNotification('An unexpected error occurred', 'error');
            event.preventDefault();
        });
    </script>
</body>
</html>